<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" []>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc toc="yes"?>
<?rfc tocdepth="2"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes" ?>
<rfc category="exp" docName="rfc-tos-specific"
ipr="trust200902" updates="6126">
<front>
<title>TOS-Specific Routing in Babel</title>
<author fullname="Gwendoline Chouasne" initials="G." surname="Chouasne">
<organization>PPS, University of Paris-Diderot</organization>
<address>
<postal>
<street>Case 7014</street>
<city>75205 Paris Cedex 13</city>
<region></region>
<code></code>
<country>France</country>
</postal>
<email>gwendoline.chouasne-guillon@ens.fr</email>
</address>
</author>
<author fullname="Juliusz Chroboczek" initials="J." surname="Chroboczek">
<organization>PPS, University of Paris-Diderot</organization>
<address>
<postal>
<street>Case 7014</street>
<city>75205 Paris Cedex 13</city>
<region></region>
<code></code>
<country>France</country>
</postal>
<email>jch@pps.univ-paris-diderot.fr</email>
</address>
</author>

<date day="10" month="May" year="2017"/>

<abstract>
<t>This document describes an extension to the Babel routing protocol to
support TOS-specific routing. This version is using mandatory sub-TLVs.</t>


</abstract>

</front>

<middle>

<section title="Introduction and background">

<t>The Type of Service (ToS) field defined in IPV4 is used to indicate
the type of routing a packet needs (for example, low-delay or high throughput).</t>

<t>This extension defines an extension to the base Babel protocol defined in 
<xref target="BABEL"/>. It enables routers to route packets according to 
their ToS field.</t>

<t>Previous implementations of ToS-specific routing are described in <xref target="TOS-ROUTING"/></t>

</section>

<section title="Data Structures">

<t>This extension needs to add data in the structures maintained by Babel.</t>

<section title="The Source Table">

<t>Every Babel node maintains a source table, as described in <xref
target="BABEL"/>, Section 3.2.4. The implementation of this ToS-specific
extension of Babel requires to extend this table with the following field:
<list style="symbols">
<t>the ToS specifying the ToS of packets to which this entry applies.</t>
</list>
<t>If this is a non-ToS-specific entry, then the ToS is set to 0.</t>

</section>

<section title="The Table of Pending Requests">

<t>Every Babel node maintains a table of pending requests, as described
in <xref target="BABEL"/>, Section 3.2.6. An implementation of this ToS-specific
extension of Babel requires to extend this table with the following field:
<list style="symbols">
<t>the ToS being requested.</t>
</list></t>

</section>

</section>

<section title="Data Forwarding">

<t>Traditionally, when a packet arrives to a node who has several suitable
routes, it chooses the one with the most specific prefix.</t>

<t>However, adding ToS to routes means a node could choose the route with the most
specific prefix and exact ToS. For example, suppose there is a route 
with ToS 8 for the prefix 192.168.5.0/24 and one with no ToS for the prefix 
192.168.0.0/16. A packet with destination 192.168.5.2 matches both of
these routes, but none of them is more specific.</t>

<t>It is important that all routers use the same priority rules between 
destination and ToS to avoid creating routing loops.</t>

<t>A Babel implementation with this extension MUST choose the route with the 
destination-first ordering. This ordering considers first the routes with
the most specific prefixes, and then chooses among them the one with the
ToS of the packet. [TODO reformuler] If it doesn't exist, then it gradually considers the
routes with the less specific prefixes, until it finds one with the required
ToS. </t>

<t>This means that a Babel implementation of this extension must ensure that
lower layers observe these semantics. If they don't, 
the implementation MUST disambiguate the routing tables by using a suitable
argorithm (for example the algorithm of M. Boutier <xref target="SS-ROUTING"/>)</t>

</section>

<section title="Protocol Operation">

<t>This extension doesn't change the fundamental operation of Babel. In this
section we describe the changes of this extension.</t>

<section title="Updates">

<t>This extension introduces a new kind of update, the ToS-specific
update. A node MUST send ToS-specific updates if the ToS is different
from 0. Otherwise, a node MUST send non-ToS-specific updates.</t>

<t>The source table MUST be updated whenever an update or a ToS-specific update
is sent. In both cases, if an entry indexed by (prefix, plen, router-id, ToS), with 
ToS 0 if the update is non-ToS-specific, exists, it is modified as
 described in section 3.7.3 of <xref target="BABEL"/>. Otherwise, a new 
entry is created with value (prefix, plen, router-id, ToS, seqno, metric), 
ToS also being 0 if the update is non-ToS-specific.</t>

<section title="Route Acquisition">

<t>When a non-ToS-specific Babel node receives an update with a ToS-specific
sub-TLV, it will ignore it, according to the base protocol defined in <xref target="BABEL"/>.</t>

<t>When a ToS-specific Babel node receives a non-ToS-specific update, it
MUST consider this update as a ToS-specific update with ToS 0.</t>

</section>

</section>

<section title="Requests">

<t>Babel nodes send updates as defined in the base protocol <xref target="BABEL"/>.
If a toS-specific Babel node needs to send a request for a route with a certain ToS,
then it MUST send the request with the sub-TLV defined in this document if the ToS
is different from 0.
If it is not, it MUST send the request without it.
</t>

</section>

</section>

<section title="Backwards compatibility">

<t>The protocol extension defined in this document is interoperable with
the base protocol defined in <xref target="BABEL"/>. In particular, 
Babel's loop-avoidance properties are preserved.
In the case of a topology of routers implementing ToS-specific Babel 
and non-ToS-specific Babel, all packets will reach their destination
if it is reachable. Non-ToS-specific packets will follow the same routes 
as if there was only non-ToS-specific routers. ToS-specific packets may
switch to a non-ToS-specific route if and only if there is no route for
the required ToS. [TODO est-ce qu'il faut mettre cette dernière phrase? ça dépend de la couche du dessous. en plus il faudrait rajouter que ça ne peut êre que la fin.enfin je sais pas)

<section title="Loop-avoidance">

<t>This extension uses a mandatory bit on each sub-TLV. It is necessary 
that this bit is set to 1 for all ToS-specific sub-TLV to avoid loops.</t>

<t>As an example, consider two routers A and B, A implementing the 
ToS-specific Babel extension, and B implementing just the base Babel 
protocol. Suppose that B has a non-ToS specific default route through C, 
and A has a non-ToS-specific default route through D and a 
ToS-specific route for a prefix P and ToS t going through B, like in the following figure. A will 
eventually send B an update with its ToS-specific route. Suppose that
B reads the update TLV but drops the ToS-specific sub-TLV and learns to 
forward packets for P through A. When a packet with ToS t arrives to A or B,
it would travel between A and B indefinitely.



<figure><artwork><![CDATA[
                        (P, t)             (::/0, 0)
                         -->                 -->
  D ------------------ A ----------------- B ----------------- C
                   <--
                 (::/0, 0)
]]></artwork></figure>

</section>

<section title="Protocol Encoding" anchor="encoding">

<t>This extension defines a new sub-TLV for turning regular Updates, Route Requests
and Seqno Requests into ToS-specific Updates, Route Requests
and Seqno Requests. Other TLVs MUST NOT use this sub-TLV.</t>

<t>The new sub-TLV MUST be used by ToS-specific Update, Route Request
and Seqno Request, as defined in this document. It is defined as follow:

<figure><artwork><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Type  = 130   |      Length       |        ToS        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
]]></artwork></figure>

<t>Fields :</t>
[TODO faire une jolie liste]
<list>
<t>Type      Set to 130 to indicate a ToS-specific sub-TLV..</t>
<t>Length    The length of the body, exclusive of the Type and Length
             fields. It SHOULD be set to 1.</t>
<t>ToS       The ToS value</t>
</list>

<t>Following is the definition of the new Update, Route Request
and Seqno Request TLVs.</t>

<section title="Update" anchor="ss-update">
<figure><artwork><![CDATA[
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Type = 8    |    Length     |      AE       |   Reserved    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      Plen     |    Omitted    |            Interval           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             Seqno             |             Metric            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Source Plen  |        Prefix...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
|  Type  = 130   |      Length       |        ToS        |
+-+-+-+-+-+-+-+-+-+-+-+-
]]></artwork></figure>

<t>All fields are unchanged.</t>

</section>

<section title="Route Request" anchor="ss-request">

<figure><artwork><![CDATA[
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Type = 9    |    Length     |      AE       |      Plen     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Source Plen  |        Prefix...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
|  Type  = 130   |      Length       |        ToS        |
+-+-+-+-+-+-+-+-+-+-+-+-
]]></artwork></figure>

<t>All fields are unchanged.</t>

<t> When a node receives a route request for a prefix (prefix, plen) with
a ToS-specific sub-TLV with ToS t, it checks its route table for a selected 
route with this prefix, plen, and with ToS t in the corresponding source. If such a route
doesn't exist, it MUST send a ToS-specific retraction for that prefix, 
with a ToS-specific sub-TLV for ToS t.</t>

</section>

<section title="Seqno Request">

<figure><artwork><![CDATA[
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Type = 10   |    Length     |      AE       |      Plen     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             Seqno             |   Hop Count   |   Reserved    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                           Router-Id                           +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Source Plen  |        Prefix...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
|  Type  = 130   |      Length       |        ToS        |
+-+-+-+-+-+-+-+-+-+-+-+-
]]></artwork></figure>

<t>All fields are unchanged.</t>

<t>When a node receives a seqno request for a prefix (prefix, plen) with
a ToS-specific sub-TLV with ToS t, it MUST send a ToS-specific update
with ToS t for a selected route specified by the Plen, Prefix and Source
ToS field, with either a router-id different from what
is specified by the Router-Id field, or a Seqno no less than what is
specified by the Seqno field. It there is no such route in the Route Table,
it MUST forward the seqno request according to the rules defined in Section
3.8.1.2 of <xref target="BABEL"/>. </t>


</section>

</section>

<section title="IANA Considerations">

[TODO: à vérifier]
<t>IANA is instructed to add the following entry to the "Babel sub-TLV type"
registry:</t>

<texttable>
<ttcol>Type</ttcol><ttcol>Name</ttcol><ttcol>Reference</ttcol>
<c>130</c><c>ToS-specific TLV</c><c>(this document)</c>
</texttable>

</section>

<section title="Security considerations">

<t>The extension defined in this protocol defines three new sub-TLVs for
defined TLVs. This extension doesn't alterate any of the security properties
of the base protocol.</t>

</section>

</middle>

<back>

<references title="Normative References">

<reference anchor="BABEL"><front>
<title>The Babel Routing Protocol</title>
<author fullname="Juliusz Chroboczek" initials="J." surname="Chroboczek"/>
<date month="February" year="2011"/>
</front>
<seriesInfo name="RFC" value="6126"/>
</reference>

<reference anchor="BABEL-EXT"><front>
<title>Extension Mechanism for the Babel Routing Protocol</title>
<author fullname="Juliusz Chroboczek" initials="J." surname="Chroboczek"/>
<date day="28" month="May" year="2015"/>
</front>
<seriesInfo name="RFC" value="7557"/>
</reference>

</references>

<references title="Informative References">

<reference anchor="SS-ROUTING">
<front>
<title>Source-Specific Routing</title>
<author initials="M." surname="Boutier" fullname="Matthieu Boutier"/>
<author initials="J." surname="Chroboczek" fullname="Juliusz Chroboczek"/>
<date year="2014" month="August"/>
</front>
<annotation>In Proc. IFIP Networking 2015.  A slightly earlier version
is available online from http://arxiv.org/pdf/1403.0445.</annotation>
</reference>

<reference anchor="TOS-ROUTING">
<front>
<title>ToS-Specific Routing</title>
<author initials="M." surname="Boutier" fullname="Matthieu Boutier"/>
<author initials="J." surname="Chroboczek" fullname="Juliusz Chroboczek"/>
<date year="2014" month="August"/>
</front>
<annotation>[TODO mettre un bo article qui parle de ToS]</annotation>
</reference>

</references>

</back>

</rfc>

